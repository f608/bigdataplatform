{% extends 'base.html' %}
{% block content %}

   <!-- 按钮触发模态框 -->
   <button class="btn btn-primary" data-toggle="modal" data-target="#kinit">
	用户认证
</button>
<!-- 模态框（Modal） -->
<div class="modal fade" id="kinit" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
					&times;
				</button>
				<h4 class="modal-title" id="myModalLabel">
					用户认证
				</h4>
			</div>
			<div class="modal-body">
				<form action="">
					用户名：<input id="username" type="text" name="user" placeholder="请输入用户名"><br><br>             
					密码：  <input id="psd" type="password" name="password" placeholder="请输入密码">
				</form>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">取消
				</button>
				<button id="user_verify" type="button" class="btn btn-primary">
					认证
				</button>
			</div>
		</div><!-- /.modal-content -->
	</div><!-- /.modal -->
</div>



<br>
<br>
     

    <div>
	<p>KDC
	<button onclick="kdc_operation('start')" type="submit" class="btn btn-primary btn-sm" >启动</button>
	<button onclick="kdc_operation('restart')" type="submit" class="btn btn-primary btn-sm" >重启</button>
	<button onclick="kdc_operation('stop')" type="submit" class="btn btn-primary btn-sm" >停止</button>     
	<button onclick="kdc_operation('status')" type="submit" class="btn btn-primary btn-sm" >查询当前状态</button>
	</p>	
	<textarea id="kdc_status_display" cols="100" rows="7" readonly="readonly">
    </textarea>
	<br/>
	<br/>
	
	<p>客户端	
	<button onclick="client_operation('start')" type="submit" class="btn btn-primary btn-sm" >启动</button>
	<button onclick="client_operation('restart')" type="submit" class="btn btn-primary btn-sm" >重启</button>
	<button onclick="client_operation('stop')" type="submit" class="btn btn-primary btn-sm" >停止</button>	
	<button onclick="client_operation('status')" type="submit" class="btn btn-primary btn-sm" >查询当前状态</button>
	</p>
	<textarea id="client_status_display" cols="100" rows="7" readonly="readonly">
    </textarea>	
    <br>
    <div style = "text-align:right">
      <button type="submit" class="btn btn-primary right">保存</button>
      <button type="submit" class="btn btn-primary">应用</button>
    </div>
{% endblock %}
{% block scripts %}
<script>
	$("#user_verify").click(function(){
		un=$('#username').val();
		psd=$('#psd').val();
		$.ajax({
			type:'POST',
			url:'/kerberos/verify/',
			data:{
				un:un,
				psd:psd
			},
			dataType:'JSON',
			beforeSend:function(){
				$("#loadgif").show();
			},
			success:function(ret){
				alert(ret.un+ret.psd)
			},
			complete:function(){
				$("#loadgif").hide();
			}
		})
	})

	function kdc_operation(op){
		$.ajax({
			type:'GET',
			url:'/kerberos/kdc/?op='+op,
			dataType:"JSON",
			beforeSend:function(){
				$("#loadgif").show();
			},
			success:function(ret){
				if(ret.op=='status'){
					$("kdc_status_display").val(ret.output)
				}
				else{
					if(ret.status){
						alert(ret.op+"失败: "+ret.output);
					}else{
						alert(ret.op+"成功");
					}
				}
				
			},
			complete:function(){
				$("#loadgif").hide();
			}
		})
	};

	function client_operation(op){
		$.ajax({
			type:'GET',
			url:'/kerberos/client/?op='+op,
			dataType:"JSON",
			beforeSend:function(){
				$("#loadgif").show();
			},
			success:function(ret){
				if(ret.op=='status'){
					$("client_status_display").val(ret.output)
				}
				else{
					if(ret.status){
						alert(ret.op+"失败: "+ret.output);
					}else{
						alert(ret.op+"成功");
					}
				}
			},
			complete:function(){
				$("#loadgif").hide();
			}
		})
	};

</script>
{% endblock %}